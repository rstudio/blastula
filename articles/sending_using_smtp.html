<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sending Email Using SMTP • blastula</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<link href="../rmd.css" rel="stylesheet">
<meta property="og:title" content="Sending Email Using SMTP">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script><!-- javascript assets for rmarkdown --><script src="../ace-1.2.3/ace.js" type="text/javascript" charset="utf-8"></script><script src="../holder-2.9.0/holder.min.js" type="text/javascript" charset="utf-8"></script><script src="../snippets/snippets.js" type="text/javascript" charset="utf-8"></script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">blastula</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.5.9000</span>
      </span>

      <!--<div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">blastula</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of  <a href=""></a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.5.9000</span>
        </div>
      </div>-->
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/blastula.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Examples

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://solutions.rstudio.com/r/blastula/" class="external-link">Custom Emails with R Markdown and Blastula</a>
    </li>
    <li>
      <a href="https://solutions.rstudio.com/r/blastula/conditional-example/" class="external-link">Customized Conditional Emails with Posit Connect</a>
    </li>
    <li>
      <a href="https://solutions.rstudio.com/data-science-admin/scheduling/" class="external-link">Scheduling Data Science Tasks</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sending_using_smtp.html">Sending Email Using SMTP</a>
    </li>
  </ul>
</li>
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    News

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../news/index.html">Changelog</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Blog posts</li>
    <li>
      <a href="https://blog.rstudio.com/2019/12/05/emails-from-r-blastula-0-3/" class="external-link">Version 0.3</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/rstudio/blastula" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sending Email Using SMTP</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/blastula/blob/master/vignettes/sending_using_smtp.Rmd" class="external-link"><code>vignettes/sending_using_smtp.Rmd</code></a></small>
      <div class="hidden name"><code>sending_using_smtp.Rmd</code></div>

    </div>

    
    
<p>After we create the an <code>email_message</code> object with
<code><a href="../reference/compose_email.html">compose_email()</a></code>, we can choose to send it through an SMTP
server using <strong>blastula</strong>’s <code><a href="../reference/smtp_send.html">smtp_send()</a></code>
function. There is some system setup required before sending a
<strong>blastula</strong> email message via SMTP. The main
considerations are:</p>
<ul>
<li>modifying an account-level setting on Gmail (if using that for
sending email)</li>
<li>optionally storing SMTP server and auth settings on disk</li>
</ul>
<p>We’ll go through each of these setup steps before getting into
several sending examples with <code><a href="../reference/smtp_send.html">smtp_send()</a></code>.</p>
<div class="section level2">
<h2 id="requirement-for-using-gmail">Requirement for Using Gmail<a class="anchor" aria-label="anchor" href="#requirement-for-using-gmail"></a>
</h2>
<p>To use <strong>blastula</strong> with <strong>Gmail</strong> you will
need to have an <strong>app password</strong> created for your Gmail
account. An app password is a password generated by Google for the
purpose of verifying an external app rather than using your standard
password. Emails sent with only your standard password pair will be
rejected by Google for security purposes. Note that to create an app
password you will also need two factor authentication enabled for your
account. To create an app password, follow the steps on the Google
Account Help page <em>Sign in with App Passwords</em>.</p>
<p><strong>Note:</strong> Previous versions of this document provided
directions for using the Less Secure Apps setting in Gmail to allow
sending blastula emails from Gmail accounts. The Less Secure Apps
setting has a sunset date of May 30, 2022 and the previous method will
no longer work after that date. Any existing R code using blastula will
need to be updated to use this new app password method.</p>
</div>
<div class="section level2">
<h2 id="storing-credentials-and-smtp-configuration-data-for-later-use">Storing Credentials and SMTP Configuration Data for Later Use<a class="anchor" aria-label="anchor" href="#storing-credentials-and-smtp-configuration-data-for-later-use"></a>
</h2>
<p>While we can provide SMTP login and configuration information
directly whenever we send email, it can be convenient to store this data
for easy retrieval. It should be noted that the manually specifying
credentials is more secure since no sensitive information is ever stored
on disk (and password entry is obscured). Should you want to store
credentials on-disk, however, there are two methods available for
this:</p>
<ol style="list-style-type: decimal">
<li>Storing credentials in the system’s key-value store</li>
<li>Storing credentials in a file</li>
</ol>
<p>The first method is more secure since access to the system-wide
key-value store requires authentication. The second is less secure since
it is the user’s responsibility to manage the resulting human-readable
JSON file. We’ll provide examples on how to use the both options
effectively.</p>
<p>We can store email credentials in the system key-value store with the
<code><a href="../reference/create_smtp_creds_key.html">create_smtp_creds_key()</a></code> function. Here is an example
showing how to create an entry with an <code>id</code> of
<code>"gmail_creds"</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store SMTP credentials using the</span></span>
<span><span class="co"># system's secure key-value store;</span></span>
<span><span class="co"># provide the `id` of "gmail"</span></span>
<span><span class="fu"><a href="../reference/create_smtp_creds_key.html">create_smtp_creds_key</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"gmail"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"user_name@gmail.com"</span>,</span>
<span>  host <span class="op">=</span> <span class="st">"smtp.gmail.com"</span>,</span>
<span>  port <span class="op">=</span> <span class="fl">465</span>,</span>
<span>  use_ssl <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>When executing this function, there will always be a prompt for the
password (i.e., there is no <code>password</code> argument in this
function).</p>
<p>We can also use preset SMTP settings. For example, if we would like
to send email through <strong>Gmail</strong>, we can supply
<code>provider = gmail</code> to not have to worry about the SMTP server
details.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store SMTP credentials in the</span></span>
<span><span class="co"># system's key-value store with</span></span>
<span><span class="co"># `provider = "gmail"`</span></span>
<span><span class="fu"><a href="../reference/create_smtp_creds_key.html">create_smtp_creds_key</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"gmail"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"user_name@gmail.com"</span>,</span>
<span>  provider <span class="op">=</span> <span class="st">"gmail"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The credentials data can be later retrieved during email sending with
the <code><a href="../reference/credential_helpers.html">creds_key()</a></code> credentials helper. Should you need to know
which keys are set in the key-value store, we can use the
<code><a href="../reference/view_credential_keys.html">view_credential_keys()</a></code> function (which shows all keys by
<code>id</code>, <code>key_name</code>, and <code>username</code>).</p>
<p>We can store email credentials in a file using the
<code><a href="../reference/create_smtp_creds_file.html">create_smtp_creds_file()</a></code> function. Here is an example
showing how to create a credentials file with the name
<code>"gmail_creds"</code> in the working directory.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store SMTP credentials as a file</span></span>
<span><span class="co"># with the filename "gmail_creds"</span></span>
<span><span class="fu"><a href="../reference/create_smtp_creds_file.html">create_smtp_creds_file</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="st">"gmail_creds"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"user_name@gmail.com"</span>,</span>
<span>  host <span class="op">=</span> <span class="st">"smtp.gmail.com"</span>,</span>
<span>  port <span class="op">=</span> <span class="fl">465</span>,</span>
<span>  use_ssl <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can also use preset SMTP settings as with the
<code><a href="../reference/create_smtp_creds_key.html">create_smtp_creds_key()</a></code> function. To send email through
<strong>Gmail</strong> we can supply <code>provider = gmail</code> to
avoid supplying <code>host</code>, <code>port</code>, and
<code>use_ssl</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a credentials file for sending</span></span>
<span><span class="co"># email through Gmail</span></span>
<span><span class="fu"><a href="../reference/create_smtp_creds_file.html">create_smtp_creds_file</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="st">"gmail_creds"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"user_name@gmail.com"</span>,</span>
<span>  provider <span class="op">=</span> <span class="st">"gmail"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The credentials data from this file can later retrieved during email
sending with the <code><a href="../reference/credential_helpers.html">creds_file()</a></code> credentials helper.</p>
</div>
<div class="section level2">
<h2 id="sending-email">Sending Email<a class="anchor" aria-label="anchor" href="#sending-email"></a>
</h2>
<p>Let’s create a simple test message with the
<code><a href="../reference/prepare_test_message.html">prepare_test_message()</a></code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the test message, this returns</span></span>
<span><span class="co"># an `email_message` object</span></span>
<span><span class="va">test_message</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_test_message.html">prepare_test_message</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview the message in the Viewer</span></span>
<span><span class="va">test_message</span></span></code></pre></div>
<p><img src="images/prepare_test_message.png" width="100%"></p>
<p align="center">
The test message
</p>
<p><br></p>
<p>Now that this test message is available, we can experiment with the
sending of it to a personal email account. Here are three examples, each
use a different method for supplying SMTP credentials.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sending email to a personal account</span></span>
<span><span class="co"># through manual specification of SMTP</span></span>
<span><span class="co"># credentials</span></span>
<span><span class="va">test_message</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/smtp_send.html">smtp_send</a></span><span class="op">(</span></span>
<span>    from <span class="op">=</span> <span class="st">"personal@email.net"</span>,</span>
<span>    to <span class="op">=</span> <span class="st">"personal@email.net"</span>,</span>
<span>    subject <span class="op">=</span> <span class="st">"Testing the `smtp_send()` function"</span>,</span>
<span>    credentials <span class="op">=</span> <span class="fu"><a href="../reference/credential_helpers.html">creds</a></span><span class="op">(</span></span>
<span>      user <span class="op">=</span> <span class="st">"user_name@gmail.com"</span>,</span>
<span>      provider <span class="op">=</span> <span class="st">"gmail"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sending email to a personal account</span></span>
<span><span class="co"># using the credentials key</span></span>
<span><span class="va">test_message</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/smtp_send.html">smtp_send</a></span><span class="op">(</span></span>
<span>    from <span class="op">=</span> <span class="st">"personal@email.net"</span>,</span>
<span>    to <span class="op">=</span> <span class="st">"personal@email.net"</span>,</span>
<span>    subject <span class="op">=</span> <span class="st">"Testing the `smtp_send()` function"</span>,</span>
<span>    credentials <span class="op">=</span> <span class="fu"><a href="../reference/credential_helpers.html">creds_key</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"gmail"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sending email to a personal account</span></span>
<span><span class="co"># using the on-disk credentials file</span></span>
<span><span class="va">test_message</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/smtp_send.html">smtp_send</a></span><span class="op">(</span></span>
<span>    from <span class="op">=</span> <span class="st">"personal@email.net"</span>,</span>
<span>    to <span class="op">=</span> <span class="st">"personal@email.net"</span>,</span>
<span>    subject <span class="op">=</span> <span class="st">"Testing the `smtp_send()` function"</span>,</span>
<span>    credentials <span class="op">=</span> <span class="fu"><a href="../reference/credential_helpers.html">creds_file</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"gmail_creds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>If the SMTP credentials are correctly set, we will get the following
message in the console:</p>
<pre><code>The email message was sent successfully.</code></pre>
</div>
<div class="section level2">
<h2 id="concluding">Concluding<a class="anchor" aria-label="anchor" href="#concluding"></a>
</h2>
<p>This covers the basics on how to get up and running on sending emails
through <strong>blastula</strong>’s SMTP functionality. If you encounter
a bug (or just have a question or feature request) please file an <a href="https://github.com/rstudio/blastula/issues" class="external-link">issue</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="tidyverse">
  <p>blastula is built for <strong>R Markdown</strong>, an ecosystem of packages for creating computational documents in R. Learn more at <a href="https://rmarkdown.rstudio.com" class="external-link">rmarkdown.rstudio.com</a>.</p>
</div>

<div class="author">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
